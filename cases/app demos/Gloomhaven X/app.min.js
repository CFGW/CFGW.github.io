document.addEventListener("DOMContentLoaded",()=>{const modifierTop=document.querySelector(".modifiers__top"),modifierBottom=document.querySelector(".modifiers__bottom"),refreshModifierBtn=document.querySelector(".shuffle-btn"),addCurseBtn=document.querySelector(".add-curse"),addBlessBtn=document.querySelector(".add-bless"),removeCurseBtn=document.querySelector(".remove-curse"),removeBlessBtn=document.querySelector(".remove-bless"),populateHandBtn=document.querySelector(".populate-hand-btn"),selectBtn=document.querySelectorAll(".select-btn"),discardBtn=document.querySelectorAll(".discard-btn"),lostBtn=document.querySelectorAll(".lost-btn"),selectedLeft=document.querySelector(".selected-cards__left"),selectedRight=document.querySelector(".selected-cards__right"),overlay=document.querySelector(".overlay"),overlayTitle=document.querySelector(".overlay h2"),closeMenuBtn=document.querySelectorAll(".menu-close"),discardMenu=document.querySelector(".discard-menu"),discardMenuBtn=document.querySelector(".discard-menu-btn"),charSheetMenu=document.querySelector(".char-sheet-menu"),charSheetMenuBtn=document.querySelector(".char-sheet-menu-btn"),conditions=document.querySelectorAll(".conditions"),activeConditions=document.querySelector(".active-conditions-container"),lvlBtnSub=document.querySelector(".lvl-sub"),lvlBtnAdd=document.querySelector(".lvl-add"),currentLvl=document.querySelector(".current-lvl"),hpBtnSub=document.querySelector(".hp-sub"),hpBtnAdd=document.querySelector(".hp-add"),currentHp=document.querySelector(".current-hp"),maxHp=document.querySelector(".max-hp"),xpBtnSub=document.querySelector(".xp-sub"),xpBtnAdd=document.querySelector(".xp-add"),currentXp=document.querySelector(".current-xp"),goldBtnSub=document.querySelector(".gold-sub"),goldBtnAdd=document.querySelector(".gold-add"),currentGold=document.querySelector(".current-gold"),discardContainerSpace=document.querySelectorAll(".discard-container-space"),discardRecoverBtn=document.querySelectorAll(".discard-recover-btn"),lostMenu=document.querySelector(".lost-menu"),lostMenuBtn=document.querySelector(".lost-menu-btn"),lostContainerSpace=document.querySelectorAll(".lost-container-space"),lostRecoverBtn=document.querySelectorAll(".lost-recover-btn"),cardMenu=document.querySelector(".card-menu"),cardMenuBtn=document.querySelector(".card-menu-btn"),cardsInHand=document.querySelectorAll(".cards-in-hand"),cardSpace=document.querySelectorAll(".card-space"),discardSpace=document.querySelector(".discard-space"),lostSpace=document.querySelector(".lost-space"),activeSpace=document.querySelectorAll(".active-space"),activeBtn=document.querySelectorAll(".active-btn"),flipBtn=document.querySelectorAll(".flip-btn"),cardContainerSpace=document.querySelectorAll(".card-container-space"),cardContainerViewer=document.querySelector(".card-container__viewer"),cardContainerListLength=document.getElementById("card-container__list-length"),cardMenuList=document.getElementById("card-container__array-list"),cardsArray=["01-deflecting-blades.png","02-corrupting-parasites.png","03-hive-mind.png","04-omniscient-assault.png","05-death-march.png","06-engulfing-stingers.png","07-call-of-the-grave.png","08-venomous-barbs.png","09-scattered-defense.png","10-swarming-minions.png","11-the-storms-edge.png","12-unstoppable-army.png","13-grasping-advance.png","14-tomb-of-the-immortal.png","15-vampiric-tempest.png","16-infest.png","17-putrid-grubs.png","18-sand-scyth.png","19-sword-of-tenacity.png","20-incubation.png","21-bioluminescence.png","22-bone-daggers.png","23-prismatic-cyclone.png","24-erosion.png","25-solitary-horde.png","26-sunstroke.png","27-focused-scourge.png","28-blood-drain.png","29-wasteland.png","30-oasis.png"],modifierArray=["crit.png","minus-1-01.png","plus-0-01.png","plus-0-02.png","plus-1-01.png","plus-1-02.png","plus-1-03.png","plus-1-04.png","plus-1-05.png","plus-2-01.png","skip.png","bs-plus-1-add-wind-01.png","bs-plus-1-add-earth-01.png","bs-plus-1-add-light-01.png","bs-plus-1-add-night-01.png","bs-heal-1-draw-again-01.png","bs-heal-1-draw-again-02.png","bs-plus-1-add-wound-01.png","bs-plus-2-add-muddle-01.png","bs-plus-1-01.png","bs-plus-1-02.png","bs-plus-1-add-poison-01.png","bs-heal-1-draw-again-03.png","bs-heal-1-draw-again-04.png"],modifierArrayDeleted=[];var discardArray=[],lostArray=[],activeArray=[],cardMenuSelectionArray=[],reA=/[^a-zA-Z]/g,reN=/[^0-9]/g;function sortAlphaNum(a,b){var aA=a.replace(reA,""),bA=b.replace(reA,"");if(aA===bA){var aN=parseInt(a.replace(reN,""),10),bN=parseInt(b.replace(reN,""),10);return aN===bN?0:aN>bN?1:-1}return aA>bA?1:-1}function overlayAnimation(){overlay.classList.add("open"),setTimeout((function(){overlay.classList.remove("open")}),700)}function discardMenuOpen(){discardMenu.classList.add("open")}function charSheetMenuOpen(){charSheetMenu.classList.add("open")}function lostMenuOpen(){lostMenu.classList.add("open")}function cardMenuOpen(){cardMenu.classList.add("open")}for(discardMenuBtn.addEventListener("click",discardMenuOpen),charSheetMenuBtn.addEventListener("click",charSheetMenuOpen),lostMenuBtn.addEventListener("click",lostMenuOpen),cardMenuBtn.addEventListener("click",cardMenuOpen),i=0;i<closeMenuBtn.length;i++){function closeMenu(){this.closest(".open").classList.remove("open")}closeMenuBtn[i].addEventListener("click",closeMenu)}for(i=0;i<conditions.length;i++){function conditionActive(){var cloneCondition=this.cloneNode(!0);this.classList.add("rotate"),activeConditions.appendChild(cloneCondition)}conditions[i].addEventListener("click",conditionActive)}document.addEventListener("click",(function(e){if(e.target&&e.target.classList.contains("conditions")&&e.target.parentNode.classList.contains("active-conditions-container")){var selectedClassId=e.target.classList[1];for(i=0;i<document.querySelector(".conditions-icon-container").childNodes.length;i++){var conditionsChildNodes=document.querySelector(".conditions-icon-container").childNodes[i];conditionsChildNodes.className=="conditions "+selectedClassId+" rotate"&&conditionsChildNodes.classList.remove("rotate")}e.target.remove()}})),currentLvl.innerHTML=localStorage.getItem("lvl"),maxHp.innerHTML=localStorage.getItem("max-lvl"),currentHp.innerHTML=localStorage.getItem("hp"),currentXp.innerHTML=localStorage.getItem("xp"),currentGold.innerHTML=localStorage.getItem("gold");var lvlCount=localStorage.getItem("lvl"),hpCount=localStorage.getItem("hp"),xpCount=localStorage.getItem("xp"),goldCount=localStorage.getItem("xp"),maxHpCount=localStorage.getItem("max-lvl");function updateMaxHp(){switch(lvlCount){case 1:maxHpCount=8,hpCount=8,maxHp.innerHTML=maxHpCount,currentHp.innerHTML=hpCount;break;case 2:maxHpCount=9,hpCount=9,maxHp.innerHTML=maxHpCount,currentHp.innerHTML=hpCount;break;case 3:maxHpCount=11,hpCount=11,maxHp.innerHTML=maxHpCount,currentHp.innerHTML=hpCount;break;case 4:maxHpCount=12,hpCount=12,maxHp.innerHTML=maxHpCount,currentHp.innerHTML=hpCount;break;case 5:maxHpCount=14,hpCount=14,maxHp.innerHTML=maxHpCount,currentHp.innerHTML=hpCount;break;case 6:maxHpCount=15,hpCount=15,maxHp.innerHTML=maxHpCount,currentHp.innerHTML=hpCount;break;case 7:maxHpCount=17,hpCount=17,maxHp.innerHTML=maxHpCount,currentHp.innerHTML=hpCount;break;case 8:maxHpCount=18,hpCount=18,maxHp.innerHTML=maxHpCount,currentHp.innerHTML=hpCount;break;case 9:maxHpCount=20,hpCount=20,maxHp.innerHTML=maxHpCount,currentHp.innerHTML=hpCount}}function subtractLevel(){lvlCount>1&&(lvlCount--,currentLvl.innerHTML=lvlCount,updateMaxHp(),localStorage.setItem("lvl",lvlCount),localStorage.setItem("max-lvl",maxHpCount),console.log("stored lvl"+localStorage.getItem("lvl")))}function addLevel(){lvlCount<9&&(lvlCount++,currentLvl.innerHTML=lvlCount,updateMaxHp(),localStorage.setItem("lvl",lvlCount),localStorage.setItem("max-lvl",maxHpCount),console.log("stored lvl"+localStorage.getItem("lvl")))}function subtractHp(){hpCount>1&&(hpCount--,currentHp.innerHTML=hpCount,localStorage.setItem("hp",hpCount),console.log("stored hp"+localStorage.getItem("hp")))}function addHp(){hpCount<maxHpCount&&(hpCount++,currentHp.innerHTML=hpCount,localStorage.setItem("hp",hpCount),console.log("stored hp"+localStorage.getItem("hp")))}function subtractXp(){xpCount>0&&(xpCount--,currentXp.innerHTML=xpCount,localStorage.setItem("xp",xpCount))}function addXp(){xpCount<999&&(xpCount++,currentXp.innerHTML=xpCount,localStorage.setItem("xp",xpCount))}function subtractGold(){goldCount>0&&(goldCount--,currentGold.innerHTML=goldCount,localStorage.setItem("gold",goldCount))}function addGold(){goldCount<999&&(goldCount++,currentGold.innerHTML=goldCount,localStorage.setItem("gold",goldCount))}function drawModifier(){if(modifierArray.length>0){var modifierArraySplice=modifierArray.splice(Math.floor(Math.random()*modifierArray.length),1)[0];modifierArrayDeleted.push(modifierArraySplice),modifierBottom.style.background="url('./images/modifiers/"+modifierArraySplice+"') center no-repeat",modifierBottom.style.backgroundSize="contain",modifierBottom.style.border="none",console.log(modifierArrayDeleted),"curse.png"==modifierArraySplice&&(modifierArrayDeleted.splice(modifierArrayDeleted.indexOf("curse.png"),1),modifierBottom.classList.add("modifier-fade"),setTimeout((function(){modifierBottom.style.background="url('./images/modifiers/"+modifierArrayDeleted[modifierArrayDeleted.length-1]+"') center no-repeat",modifierBottom.style.backgroundSize="contain",modifierBottom.style.border="none",modifierBottom.classList.remove("modifier-fade")}),1200),setTimeout((function(){let curseAmount=modifierArray.filter((function(x){return"curse.png"===x}));overlayTitle.innerHTML="Curse Removed <span class='tiny-text'>( "+curseAmount.length+" )</span>",overlayAnimation()}),1300)),"bless.png"==modifierArraySplice&&(modifierArrayDeleted.splice(modifierArrayDeleted.indexOf("bless.png"),1),modifierBottom.classList.add("modifier-fade"),setTimeout((function(){modifierBottom.style.background="url('./images/modifiers/"+modifierArrayDeleted[modifierArrayDeleted.length-1]+"') center no-repeat",modifierBottom.style.backgroundSize="contain",modifierBottom.style.border="none",modifierBottom.classList.remove("modifier-fade")}),1200),setTimeout((function(){let blessAmount=modifierArray.filter((function(x){return"bless.png"===x}));overlayTitle.innerHTML="Bless Removed <span class='tiny-text'>( "+blessAmount.length+" )</span>",overlayAnimation()}),1300))}else overlayTitle.innerHTML="MODIFIER DECK EMPTY",overlayAnimation();modifierArray.length<1&&(modifierTop.style.background="none",modifierTop.style.border="1px dashed rgb(173, 173, 173)")}function refreshModifier(){for(i=0;i<modifierArrayDeleted.length;i++)modifierArray.push(modifierArrayDeleted[i]),modifierArrayDeleted.splice(i,1),i--;modifierTop.style.background="url('./images/modifiers/modifier-back.png') center no-repeat",modifierTop.style.backgroundSize="contain",modifierTop.style.border="none",modifierBottom.style.background="none",modifierBottom.style.border="1px dashed rgb(173, 173, 173)",overlayTitle.innerHTML="REFRESH MODIFIER",overlayAnimation()}function addCurse(){modifierArray.push("curse.png");let curseAmount=modifierArray.filter((function(x){return"curse.png"===x}));overlayTitle.innerHTML="Curse Added <span class='tiny-text'>( "+curseAmount.length+" )</span>",overlayAnimation()}function removeCurse(){if(-1!==modifierArray.indexOf("curse.png")){modifierArray.splice(modifierArray.indexOf("curse.png"),1);let curseAmount=modifierArray.filter((function(x){return"curse.png"===x}));overlayTitle.innerHTML="Curse Removed <span class='tiny-text'>( "+curseAmount.length+" )</span>",overlayAnimation()}else overlayTitle.innerHTML="No Curse Found",overlayAnimation()}function addBless(){modifierArray.push("bless.png");let blessAmount=modifierArray.filter((function(x){return"bless.png"===x}));overlayTitle.innerHTML="Bless Added <span class='tiny-text'>( "+blessAmount.length+" )</span>",overlayAnimation()}function removeBless(){if(-1!==modifierArray.indexOf("bless.png")){modifierArray.splice(modifierArray.indexOf("bless.png"),1);let blessAmount=modifierArray.filter((function(x){return"bless.png"===x}));overlayTitle.innerHTML="Bless Removed <span class='tiny-text'>( "+blessAmount.length+" )</span>",overlayAnimation()}else overlayTitle.innerHTML="No Bless Found",overlayAnimation()}function renderCardMenu(){for(j=0;j<cardContainerSpace.length;j++)for(i=0;i<cardsArray.length;i++)cardContainerSpace[j].classList.add("deck-"+[j]),null!==localStorage.getItem("flipped"+[j])&&cardContainerSpace[j].classList.add("deck-flipped")}for(lvlBtnSub.addEventListener("click",subtractLevel),lvlBtnAdd.addEventListener("click",addLevel),hpBtnSub.addEventListener("click",subtractHp),hpBtnAdd.addEventListener("click",addHp),xpBtnSub.addEventListener("click",subtractXp),xpBtnAdd.addEventListener("click",addXp),goldBtnSub.addEventListener("click",subtractGold),goldBtnAdd.addEventListener("click",addGold),modifierTop.addEventListener("click",drawModifier),refreshModifierBtn.addEventListener("click",refreshModifier),addCurseBtn.addEventListener("click",addCurse),removeCurseBtn.addEventListener("click",removeCurse),addBlessBtn.addEventListener("click",addBless),removeBlessBtn.addEventListener("click",removeBless),cardMenuBtn.addEventListener("click",renderCardMenu),i=0;i<cardContainerSpace.length;i++){function renderCardViewer(){for(j=0;j<cardContainerSpace.length;j++)1==this.closest(".card-container-space").classList.contains("deck-"+[j])&&(cardContainerViewer.className="",cardContainerViewer.classList.add("card-container__viewer"),cardContainerViewer.classList.add("deck-"+[j]))}cardContainerSpace[i].addEventListener("mouseover",renderCardViewer)}for(i=0;i<cardContainerSpace.length;i++){function renderCardSelection(){for(j=0;j<cardContainerSpace.length;j++)if(1==this.closest(".card-container-space").classList.contains("deck-"+[j])&&cardMenuSelectionArray.length<=10&&-1==cardMenuSelectionArray.indexOf("deck-"+[j])){cardMenuSelectionArray.push("deck-"+[j]);const cardMenuListItem=document.createElement("li");cardMenuListItem.className="card-container__list-item",cardMenuListItem.setAttribute("data-deck","deck-"+[j]),cardMenuListItem.innerHTML=cardsArray[j].slice(0,-4),cardMenuList.appendChild(cardMenuListItem),cardContainerListLength.innerHTML=cardMenuList.children.length,console.log(cardMenuSelectionArray)}}cardContainerSpace[i].addEventListener("click",renderCardSelection)}function renderHand(){for(j=0;j<cardsInHand.length;j++)cardsInHand[j].className="",cardsInHand[j].classList.add("card-space","cards-in-hand",cardMenuSelectionArray[j]);cardMenu.classList.remove("open")}for(document.addEventListener("click",(function(e){e.target&&"LI"==e.target.nodeName&&(cardMenuSelectionArray.splice(cardMenuSelectionArray.indexOf(e.target.getAttribute("data-deck")),1),e.target.parentNode.removeChild(e.target),cardContainerListLength.innerHTML=cardMenuList.children.length)})),populateHandBtn.addEventListener("click",renderHand),i=0;i<selectBtn.length;i++){function renderSelection(){for(j=0;j<cardsInHand.length;j++)1==this.closest(".card-space").classList.contains(cardMenuSelectionArray[j])&&selectedLeft.classList.contains("selected")&&selectedRight.classList.contains("selected")?(overlayTitle.innerHTML="CARDS ALREADY SELECTED",overlayAnimation()):1==this.closest(".card-space").classList.contains(cardMenuSelectionArray[j])&&selectedLeft.classList.contains("selected")?(selectedRight.classList.add("selected",cardMenuSelectionArray[j]),this.closest(".card-space").classList.remove(cardMenuSelectionArray[j])):1!=this.closest(".card-space").classList.contains(cardMenuSelectionArray[j])||selectedLeft.classList.contains("selected")||(selectedLeft.classList.add("selected",cardMenuSelectionArray[j]),this.closest(".card-space").classList.remove(cardMenuSelectionArray[j]))}selectBtn[i].addEventListener("click",renderSelection)}for(i=0;i<discardBtn.length;i++){function renderDiscard(){for(j=0;j<cardSpace.length;j++)1==this.closest(".card-space").classList.contains(cardMenuSelectionArray[j])&&(discardSpace.className="",discardSpace.classList.add("discard-space"),discardSpace.classList.add(cardMenuSelectionArray[j]),discardArray.push(cardMenuSelectionArray[j]),discardArray.sort(sortAlphaNum),console.log(discardArray),this.closest(".card-space").classList.remove(cardMenuSelectionArray[j]),discardContainerSpace[j].classList.add(cardMenuSelectionArray[j]),1==this.closest(".card-space").classList.contains("active-space")&&(this.closest(".card-space").style.width="0px"),1==this.closest(".card-space").classList.contains("selected")&&this.closest(".card-space").classList.remove("selected"))}discardBtn[i].addEventListener("click",renderDiscard)}for(i=0;i<discardRecoverBtn.length;i++){function recoverFromDiscard(){for(j=0;j<discardContainerSpace.length;j++)1==this.closest(".discard-container-space").classList.contains(cardMenuSelectionArray[j])&&(cardsInHand[j].classList.add(cardMenuSelectionArray[j]),discardContainerSpace[j].classList.remove(cardMenuSelectionArray[j]),discardSpace.className="",discardSpace.classList.add("discard-space","deck-back"),discardArray.splice(cardMenuSelectionArray[j],1),discardArray.length<1&&(discardSpace.className="",discardSpace.classList.add("discard-space")))}discardRecoverBtn[i].addEventListener("click",recoverFromDiscard)}for(i=0;i<lostBtn.length;i++){function renderLost(){for(j=0;j<cardSpace.length;j++)1==this.closest(".card-space").classList.contains(cardMenuSelectionArray[j])&&(lostSpace.className="",lostSpace.classList.add("lost-space"),lostSpace.classList.add(cardMenuSelectionArray[j]),lostArray.push(cardMenuSelectionArray[j]),lostArray.sort(sortAlphaNum),console.log(lostArray),this.closest(".card-space").classList.remove(cardMenuSelectionArray[j]),lostContainerSpace[j].classList.add(cardMenuSelectionArray[j]),1==this.closest(".card-space").classList.contains("active-space")&&(this.closest(".card-space").style.width="0px"),1==this.closest(".card-space").classList.contains("selected")&&this.closest(".card-space").classList.remove("selected"))}lostBtn[i].addEventListener("click",renderLost)}for(i=0;i<lostRecoverBtn.length;i++){function recoverFromLost(){for(j=0;j<lostContainerSpace.length;j++)1==this.closest(".lost-container-space").classList.contains(cardMenuSelectionArray[j])&&(cardsInHand[j].classList.add(cardMenuSelectionArray[j]),lostContainerSpace[j].classList.remove(cardMenuSelectionArray[j]),lostSpace.className="",lostSpace.classList.add("lost-space","deck-back"),lostArray.splice(cardMenuSelectionArray[j],1),lostArray.length<1&&(lostSpace.className="",lostSpace.classList.add("lost-space")))}lostRecoverBtn[i].addEventListener("click",recoverFromLost)}for(i=0;i<activeBtn.length;i++){function renderActive(){for(j=0;j<cardSpace.length;j++)1==this.closest(".card-space").classList.contains(cardMenuSelectionArray[j])&&(activeSpace[j].className="",activeSpace[j].classList.add("card-space","active-space"),activeSpace[j].classList.add(cardMenuSelectionArray[j]),activeSpace[j].style.visibility="visible",activeSpace[j].style.width="160px",activeArray.push(cardMenuSelectionArray[j]),activeArray.sort(sortAlphaNum),this.closest(".card-space").classList.remove(cardMenuSelectionArray[j]),1==this.closest(".card-space").classList.contains("selected")&&this.closest(".card-space").classList.remove("selected"))}activeBtn[i].addEventListener("click",renderActive)}for(i=0;i<flipBtn.length;i++){function renderFlip(e){e.stopPropagation(),this.closest(".card-container-space").classList.contains("deck-flipped")?(this.closest(".card-container-space").classList.remove("deck-flipped"),localStorage.removeItem("flipped"+Array.from(flipBtn).indexOf(e.target),"deck-flipped")):(this.closest(".card-container-space").classList.add("deck-flipped"),localStorage.setItem("flipped"+Array.from(flipBtn).indexOf(e.target),"deck-flipped"))}flipBtn[i].addEventListener("click",renderFlip)}});